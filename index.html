<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2575.7">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #4689cc; -webkit-text-stroke: #4689cc}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #8cd3fe; -webkit-text-stroke: #8cd3fe}
    p.p3 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #c27e65; -webkit-text-stroke: #c27e65}
    p.p4 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #cacaca; -webkit-text-stroke: #cacaca}
    p.p5 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #71c083; -webkit-text-stroke: #71c083}
    p.p6 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #cacaca; -webkit-text-stroke: #cacaca; min-height: 16.0px}
    p.p7 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #6d7378; -webkit-text-stroke: #6d7378}
    p.p8 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #36c0a0; -webkit-text-stroke: #36c0a0}
    p.p9 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #71c083; -webkit-text-stroke: #71c083; min-height: 16.0px}
    span.s1 {font-kerning: none; background-color: #171818}
    span.s2 {font-kerning: none; color: #8cd3fe; background-color: #171818; -webkit-text-stroke: 0px #8cd3fe}
    span.s3 {font-kerning: none; color: #6d6d6d; background-color: #171818; -webkit-text-stroke: 0px #6d6d6d}
    span.s4 {font-kerning: none; color: #cacaca; background-color: #171818; -webkit-text-stroke: 0px #cacaca}
    span.s5 {font-kerning: none; color: #c27e65; background-color: #171818; -webkit-text-stroke: 0px #c27e65}
    span.s6 {font-kerning: none; color: #4689cc; background-color: #171818; -webkit-text-stroke: 0px #4689cc}
    span.s7 {font-kerning: none; color: #d4d4d4; background-color: #171818; -webkit-text-stroke: 0px #d4d4d4}
    span.s8 {font-kerning: none; color: #71c083; background-color: #171818; -webkit-text-stroke: 0px #71c083}
    span.s9 {font-kerning: none; color: #a7c598; background-color: #171818; -webkit-text-stroke: 0px #a7c598}
    span.s10 {font-kerning: none; color: #b76ff7; background-color: #171818; -webkit-text-stroke: 0px #b76ff7}
    span.s11 {font-kerning: none}
    span.s12 {font-kerning: none; color: #36c0a0; background-color: #171818; -webkit-text-stroke: 0px #36c0a0}
    span.s13 {font-kerning: none; color: #f67c30; background-color: #171818; -webkit-text-stroke: 0px #f67c30}
    span.s14 {font-kerning: none; color: #6d7378; background-color: #171818; -webkit-text-stroke: 0px #6d7378}
    span.s15 {font-kerning: none; color: #a34f83; background-color: #171818; -webkit-text-stroke: 0px #a34f83}
  </style>
</head>
<body>
<p class="p1"><span class="s1">&lt;!DOCTYPE</span><span class="s2"> html</span><span class="s1">&gt;</span></p>
<p class="p1"><span class="s3">&lt;</span><span class="s1">html</span><span class="s4"> </span><span class="s2">lang</span><span class="s3">=</span><span class="s5">"ja"</span><span class="s3">&gt;</span></p>
<p class="p1"><span class="s3">&lt;</span><span class="s1">head</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">meta</span><span class="s4"> </span><span class="s1">charset</span><span class="s3">=</span><span class="s5">"UTF-8"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">meta</span><span class="s4"> </span><span class="s2">name</span><span class="s3">=</span><span class="s1">"viewport"</span><span class="s4"> </span><span class="s2">content</span><span class="s3">=</span><span class="s1">"width=device-width, initial-scale=1.0"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">title</span><span class="s3">&gt;</span><span class="s1">AIキャプションメーカー</span><span class="s3">&lt;/</span><span class="s6">title</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">script</span><span class="s4"> </span><span class="s2">src</span><span class="s3">=</span><span class="s1">"https://cdn.tailwindcss.com"</span><span class="s3">&gt;&lt;/</span><span class="s6">script</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">link</span><span class="s4"> </span><span class="s2">rel</span><span class="s3">=</span><span class="s1">"preconnect"</span><span class="s4"> </span><span class="s2">href</span><span class="s3">=</span><span class="s1">"https://fonts.googleapis.com"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">link</span><span class="s4"> </span><span class="s2">rel</span><span class="s3">=</span><span class="s1">"preconnect"</span><span class="s4"> </span><span class="s2">href</span><span class="s3">=</span><span class="s1">"https://fonts.gstatic.com"</span><span class="s4"> </span><span class="s2">crossorigin</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">link</span><span class="s4"> </span><span class="s2">href</span><span class="s3">=</span><span class="s1">"https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@400;700&amp;family=Noto+Sans+JP:wght@400;700&amp;display=swap"</span><span class="s4"> </span><span class="s2">rel</span><span class="s3">=</span><span class="s1">"stylesheet"</span><span class="s3">&gt;</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s1">style</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s6">body</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">font-family:</span><span class="s1"> </span><span class="s8">'Noto Sans JP'</span><span class="s7">,</span><span class="s1"> </span><span class="s5">sans-serif</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">background-color:</span><span class="s1"> #FDFDFD</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">color:</span><span class="s1"> #4A4A4A</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s6">.button</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s2">transition:</span><span class="s4"> </span><span class="s1">background-color</span><span class="s4"> </span><span class="s9">0.3s</span><span class="s7">,</span><span class="s4"> </span><span class="s1">transform</span><span class="s4"> </span><span class="s9">0.2s</span><span class="s7">,</span><span class="s4"> </span><span class="s1">box-shadow</span><span class="s4"> </span><span class="s9">0.3s</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">.button:hover</span><span class="s4"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">transform:</span><span class="s1"> </span><span class="s5">translateY(</span><span class="s9">-2px</span><span class="s5">)</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">box-shadow:</span><span class="s1"> </span><span class="s9">0</span><span class="s1"> </span><span class="s9">4px</span><span class="s1"> </span><span class="s9">6px</span><span class="s1"> </span><span class="s5">rgba(</span><span class="s9">0</span><span class="s7">,</span><span class="s1"> </span><span class="s9">0</span><span class="s7">,</span><span class="s1"> </span><span class="s9">0</span><span class="s7">,</span><span class="s1"> </span><span class="s9">0.1</span><span class="s5">)</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s6">.card</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">background-color:</span><span class="s1"> #FFFFFF</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">border:</span><span class="s1"> </span><span class="s9">1px</span><span class="s1"> </span><span class="s5">solid</span><span class="s1"> #E0D9C8</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">box-shadow:</span><span class="s1"> </span><span class="s9">0</span><span class="s1"> </span><span class="s9">4px</span><span class="s1"> </span><span class="s9">12px</span><span class="s1"> </span><span class="s5">rgba(</span><span class="s9">0</span><span class="s7">,</span><span class="s9">0</span><span class="s7">,</span><span class="s9">0</span><span class="s7">,</span><span class="s9">0.05</span><span class="s5">)</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">#imageAnalysisResult</span><span class="s7">,</span><span class="s4"> </span><span class="s1">#uploadedImage</span><span class="s4"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">animation:</span><span class="s1"> </span><span class="s5">fadeIn</span><span class="s1"> </span><span class="s9">0.8s</span><span class="s1"> </span><span class="s5">ease-out</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">@keyframes</span><span class="s1"> </span><span class="s5">fadeIn</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s5">from</span><span class="s1"> </span><span class="s7">{</span><span class="s1"> </span><span class="s2">opacity:</span><span class="s1"> </span><span class="s9">0</span><span class="s7">;</span><span class="s1"> </span><span class="s2">transform:</span><span class="s1"> </span><span class="s5">translateY(</span><span class="s9">10px</span><span class="s5">)</span><span class="s7">;</span><span class="s1"> </span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s5">to</span><span class="s1"> </span><span class="s7">{</span><span class="s1"> </span><span class="s2">opacity:</span><span class="s1"> </span><span class="s9">1</span><span class="s7">;</span><span class="s1"> </span><span class="s2">transform:</span><span class="s1"> </span><span class="s5">translateY(</span><span class="s9">0</span><span class="s5">)</span><span class="s7">;</span><span class="s1"> </span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">.dot-pulse</span><span class="s4"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">position:</span><span class="s1"> </span><span class="s5">relative</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">left:</span><span class="s1"> </span><span class="s9">-9999px</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">width:</span><span class="s1"> </span><span class="s9">10px</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">height:</span><span class="s1"> </span><span class="s9">10px</span><span class="s7">;</span></p>
<p class="p2"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">border-radius:</span><span class="s4"> </span><span class="s9">5px</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">background-color:</span><span class="s1"> #0E4D92</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">color:</span><span class="s1"> #0E4D92</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">box-shadow:</span><span class="s1"> </span><span class="s9">9999px</span><span class="s1"> </span><span class="s9">0</span><span class="s1"> </span><span class="s9">0</span><span class="s1"> </span><span class="s9">-5px</span><span class="s7">;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s2">animation:</span><span class="s4"> </span><span class="s1">dot-pulse</span><span class="s4"> </span><span class="s9">1.5s</span><span class="s4"> </span><span class="s1">infinite</span><span class="s4"> </span><span class="s1">linear</span><span class="s7">;</span></p>
<p class="p2"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">animation-delay:</span><span class="s4"> </span><span class="s9">.25s</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">.dot-pulse::before</span><span class="s7">,</span><span class="s4"> </span><span class="s1">.dot-pulse::after</span><span class="s4"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">content:</span><span class="s1"> </span><span class="s8">''</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">display:</span><span class="s1"> </span><span class="s5">inline-block</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">position:</span><span class="s1"> </span><span class="s5">absolute</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">top:</span><span class="s1"> </span><span class="s9">0</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">width:</span><span class="s1"> </span><span class="s9">10px</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">height:</span><span class="s1"> </span><span class="s9">10px</span><span class="s7">;</span></p>
<p class="p2"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">border-radius:</span><span class="s4"> </span><span class="s9">5px</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">background-color:</span><span class="s1"> #0E4D92</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">color:</span><span class="s1"> #0E4D92</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">.dot-pulse::before</span><span class="s4"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">box-shadow:</span><span class="s1"> </span><span class="s9">9984px</span><span class="s1"> </span><span class="s9">0</span><span class="s1"> </span><span class="s9">0</span><span class="s1"> </span><span class="s9">-5px</span><span class="s7">;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s2">animation:</span><span class="s4"> </span><span class="s1">dot-pulse-before</span><span class="s4"> </span><span class="s9">1.5s</span><span class="s4"> </span><span class="s1">infinite</span><span class="s4"> </span><span class="s1">linear</span><span class="s7">;</span></p>
<p class="p2"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">animation-delay:</span><span class="s4"> </span><span class="s9">0s</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s10">@keyframes</span><span class="s4"> </span><span class="s1">dot-pulse-before</span><span class="s4"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s9">0%</span><span class="s1"> </span><span class="s7">{</span><span class="s1"> </span><span class="s2">box-shadow:</span><span class="s1"> </span><span class="s9">9984px</span><span class="s1"> </span><span class="s9">0</span><span class="s1"> </span><span class="s9">0</span><span class="s1"> </span><span class="s9">-5px</span><span class="s7">;</span><span class="s1"> </span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s9">30%</span><span class="s1"> </span><span class="s7">{</span><span class="s1"> </span><span class="s2">box-shadow:</span><span class="s1"> </span><span class="s9">9984px</span><span class="s1"> </span><span class="s9">0</span><span class="s1"> </span><span class="s9">0</span><span class="s1"> </span><span class="s9">2px</span><span class="s7">;</span><span class="s1"> </span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s9">60%</span><span class="s7">,</span><span class="s1"> </span><span class="s9">100%</span><span class="s1"> </span><span class="s7">{</span><span class="s1"> </span><span class="s2">box-shadow:</span><span class="s1"> </span><span class="s9">9984px</span><span class="s1"> </span><span class="s9">0</span><span class="s1"> </span><span class="s9">0</span><span class="s1"> </span><span class="s9">-5px</span><span class="s7">;</span><span class="s1"> </span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">.dot-pulse::after</span><span class="s4"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">box-shadow:</span><span class="s1"> </span><span class="s9">10014px</span><span class="s1"> </span><span class="s9">0</span><span class="s1"> </span><span class="s9">0</span><span class="s1"> </span><span class="s9">-5px</span><span class="s7">;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s2">animation:</span><span class="s4"> </span><span class="s1">dot-pulse-after</span><span class="s4"> </span><span class="s9">1.5s</span><span class="s4"> </span><span class="s1">infinite</span><span class="s4"> </span><span class="s1">linear</span><span class="s7">;</span></p>
<p class="p2"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">animation-delay:</span><span class="s4"> </span><span class="s9">.5s</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s10">@keyframes</span><span class="s4"> </span><span class="s1">dot-pulse-after</span><span class="s4"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s9">0%</span><span class="s1"> </span><span class="s7">{</span><span class="s1"> </span><span class="s2">box-shadow:</span><span class="s1"> </span><span class="s9">10014px</span><span class="s1"> </span><span class="s9">0</span><span class="s1"> </span><span class="s9">0</span><span class="s1"> </span><span class="s9">2px</span><span class="s7">;</span><span class="s1"> </span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s9">30%</span><span class="s1"> </span><span class="s7">{</span><span class="s1"> </span><span class="s2">box-shadow:</span><span class="s1"> </span><span class="s9">10014px</span><span class="s1"> </span><span class="s9">0</span><span class="s1"> </span><span class="s9">0</span><span class="s1"> </span><span class="s9">-5px</span><span class="s7">;</span><span class="s1"> </span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s9">60%</span><span class="s7">,</span><span class="s1"> </span><span class="s9">100%</span><span class="s1"> </span><span class="s7">{</span><span class="s1"> </span><span class="s2">box-shadow:</span><span class="s1"> </span><span class="s9">10014px</span><span class="s1"> </span><span class="s9">0</span><span class="s1"> </span><span class="s9">0</span><span class="s1"> </span><span class="s9">-5px</span><span class="s7">;</span><span class="s1"> </span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">@keyframes</span><span class="s1"> </span><span class="s5">dot-pulse</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s9">0%</span><span class="s1"> </span><span class="s7">{</span><span class="s1"> </span><span class="s2">box-shadow:</span><span class="s1"> </span><span class="s9">9999px</span><span class="s1"> </span><span class="s9">0</span><span class="s1"> </span><span class="s9">0</span><span class="s1"> </span><span class="s9">-5px</span><span class="s7">;</span><span class="s1"> </span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s9">30%</span><span class="s1"> </span><span class="s7">{</span><span class="s1"> </span><span class="s2">box-shadow:</span><span class="s1"> </span><span class="s9">9999px</span><span class="s1"> </span><span class="s9">0</span><span class="s1"> </span><span class="s9">0</span><span class="s1"> </span><span class="s9">2px</span><span class="s7">;</span><span class="s1"> </span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s9">60%</span><span class="s7">,</span><span class="s1"> </span><span class="s9">100%</span><span class="s1"> </span><span class="s7">{</span><span class="s1"> </span><span class="s2">box-shadow:</span><span class="s1"> </span><span class="s9">9999px</span><span class="s1"> </span><span class="s9">0</span><span class="s1"> </span><span class="s9">0</span><span class="s1"> </span><span class="s9">-5px</span><span class="s7">;</span><span class="s1"> </span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">.caption-text</span><span class="s4"> </span><span class="s7">{</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s2">font-family:</span><span class="s4"> </span><span class="s1">'Noto Serif JP'</span><span class="s7">,</span><span class="s4"> </span><span class="s5">serif</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;/</span><span class="s1">style</span><span class="s3">&gt;</span></p>
<p class="p1"><span class="s3">&lt;/</span><span class="s1">head</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s3">&lt;</span><span class="s6">body</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"antialiased flex flex-col items-center min-h-screen p-2 sm:p-4"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">main</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"w-full max-w-4xl text-center bg-gray-100 p-4 sm:p-8 rounded-lg shadow-inner card"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;</span><span class="s6">h2</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-3xl md:text-4xl font-bold mb-6 text-[#4A4A4A]"</span><span class="s3">&gt;</span><span class="s4">✨ AIキャプションメーカー ✨</span><span class="s3">&lt;/</span><span class="s6">h2</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;</span><span class="s6">p</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"text-base sm:text-lg mb-8 text-[#6B6B6B]"</span><span class="s3">&gt;</span><span class="s1">表美展に出展するあなたの作品をアップロードして、AIに「温故創新」のテーマに沿ったキャプションを生成してもらいましょう。</span><span class="s3">&lt;/</span><span class="s6">p</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">&lt;!-- Image Preview Section --&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"imagePreviewContainer"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"mb-8 hidden"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">img</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"uploadedImage"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"max-h-[250px] sm:max-h-[400px] w-auto h-auto rounded-lg shadow-md mx-auto object-contain"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"space-y-6"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-left p-4 sm:p-6 rounded-lg card"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">p</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"text-sm mb-4 font-semibold"</span><span class="s3">&gt;</span><span class="s1">ステップ1: 作品の写真をアップロード</span><span class="s3">&lt;/</span><span class="s6">p</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"flex flex-col items-center justify-center"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s6">label</span><span class="s4"> </span><span class="s2">for</span><span class="s3">=</span><span class="s1">"imageInput"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"button inline-block py-3 px-6 rounded-md bg-[#0E4D92] text-white cursor-pointer hover:bg-[#1263B7]"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s6">span</span><span class="s1"> </span><span class="s2">id</span><span class="s3">=</span><span class="s5">"fileName"</span><span class="s3">&gt;</span><span class="s1">ファイルを選択</span><span class="s3">&lt;/</span><span class="s6">span</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;/</span><span class="s6">label</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s6">input</span><span class="s4"> </span><span class="s2">type</span><span class="s3">=</span><span class="s1">"file"</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"imageInput"</span><span class="s4"> </span><span class="s2">accept</span><span class="s3">=</span><span class="s1">"image/*"</span><span class="s4"> </span><span class="s2">onchange</span><span class="s3">=</span><span class="s1">"displayFileName(event)"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"hidden"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-left p-4 sm:p-6 rounded-lg card"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">p</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"text-sm mb-4 font-semibold"</span><span class="s3">&gt;</span><span class="s1">ステップ2: 作品に関するキーワードを入力</span><span class="s3">&lt;/</span><span class="s6">p</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">textarea</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"keywordsInput"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"w-full h-24 p-2 rounded-md border border-gray-300 resize-none focus:outline-none focus:ring-2 focus:ring-[#0E4D92] transition-all"</span><span class="s4"> </span><span class="s2">placeholder</span><span class="s3">=</span><span class="s1">"例：伝統的な技法、未来的なデザイン、静寂、光と影"</span><span class="s3">&gt;&lt;/</span><span class="s6">textarea</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-left p-4 sm:p-6 rounded-lg card"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">p</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"text-sm mb-4 font-semibold"</span><span class="s3">&gt;</span><span class="s1">ステップ3: キャプションを生成</span><span class="s3">&lt;/</span><span class="s6">p</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">button</span><span class="s4"> </span><span class="s2">onclick</span><span class="s3">=</span><span class="s1">"analyzeImage()"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"button w-full py-3 px-6 bg-[#0E4D92] text-white rounded-md hover:bg-[#1263B7]"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>キャプションを生成する</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;/</span><span class="s6">button</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"imageAnalysisResult"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"mt-8 text-left p-4 sm:p-6 rounded-lg card min-h-[100px] flex items-center justify-center"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">p</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"text-gray-400"</span><span class="s3">&gt;</span><span class="s1">ここにAIによるキャプションが表示されます。</span><span class="s3">&lt;/</span><span class="s6">p</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;/</span><span class="s6">main</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">footer</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"mt-8 text-center text-xs text-gray-500"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;</span><span class="s6">p</span><span class="s3">&gt;</span><span class="s1">Created by TANAKA Hiroshi</span><span class="s3">&lt;/</span><span class="s6">p</span><span class="s3">&gt;</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;/</span><span class="s1">footer</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s1">script</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s10">const</span><span class="s4"> </span><span class="s12">API_KEY</span><span class="s4"> </span><span class="s7">=</span><span class="s4"> </span><span class="s1">"AIzaSyBmuD2c_M6Kg_GRk7TJpqXGNzsZGH3FeME"</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">let</span><span class="s1"> currentImageBase64 </span><span class="s7">=</span><span class="s1"> </span><span class="s10">null</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">let</span><span class="s1"> currentKeywords </span><span class="s7">=</span><span class="s1"> </span><span class="s8">""</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">let</span><span class="s1"> currentMimeType </span><span class="s7">=</span><span class="s1"> </span><span class="s10">null</span><span class="s7">;</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// 表美展の開催要項を定数として定義</span></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s10">const</span><span class="s4"> </span><span class="s1">EXHIBITION_DOCUMENT</span><span class="s4"> </span><span class="s7">=</span><span class="s4"> </span><span class="s8">`第70回記念表美展 開催要項</span></p>
<p class="p5"><span class="s1">「温故創新-Innovation from the past」</span></p>
<p class="p5"><span class="s1">開催概要</span></p>
<p class="p5"><span class="s1">主催 : 京都表具協同組合</span></p>
<p class="p5"><span class="s1">後援 : 京都府、京都市、京都府中小企業団体中央会、京都商工会議所、近畿経済産業局、一般財団法人伝統的工芸品産業振興協会、京都新聞、KBS京都</span></p>
<p class="p5"><span class="s1">協賛 : 京都府職業能力開発協会、全国表具経師内装組合連合会、西日本表具内装協会、京表具協同組合連合会、京都伝統工芸協議会</span></p>
<p class="p5"><span class="s1">会場 : 京都市勧業館 みやこめっせ地階A展示室 (〒606-8343 京都市左京区岡崎成勝寺町90-1)</span></p>
<p class="p5"><span class="s1">会期 : 令和7年10月18日(土)～19日(日) 10:00～17:00</span></p>
<p class="p5"><span class="s1">搬入 : 令和7年10月17日(金)</span></p>
<p class="p5"><span class="s1">テーマ : 「温故創新-Innovation from the past」</span></p>
<p class="p5"><span class="s1">開催目的</span></p>
<p class="p5"><span class="s1">表具および内装技術のさらなる向上を目指し、デジタル事業との連携を通じて新たな市場領域を拡大します。本展は、未来を拓く事業変革の先駆けとなることを目標とします。</span></p>
<p class="p5"><span class="s1">特別企画</span></p>
<p class="p5"><span class="s1">70回記念展示「黄金の茶室」 : 第60回展でご好評いただいた「黄金の茶室」を特別展示いたします。中断しておりましたお茶の提供も、「黄金の茶室」に限り、限定数にて有料で再開する予定です。</span></p>
<p class="p5"><span class="s1">アートパネルブース : 昨年より開始し、多大な評価をいただいているブースです。今年のテーマに沿った作品を募集し、出品作品は来場者によるオンライン投票で評価、今後の作品ブラッシュアップに繋げます。高評価作品には商品券等を贈呈いたします。</span></p>
<p class="p5"><span class="s1">プロモーション戦略</span></p>
<p class="p5"><span class="s1">オンライン : 例年通り、組合公式WEBサイト、SNS、ECサイトを駆使し、早期からのオンライン集客を強化します。</span></p>
<p class="p5"><span class="s1">オフライン : 京都市営地下鉄改札付近でのポスター掲示により、効果的な集客を図ります。</span></p>
<p class="p5"><span class="s1">出展要項</span></p>
<p class="p5"><span class="s1">自由出品 : 「自由出品（褒章審査対象外）」を受け付け、多くの組合員の皆様からのご応募をお待ちしております。</span></p>
<p class="p5"><span class="s1">作品説明 : 出品作品には、例年通りキャプション（説明文）を添えて展示いたします。</span></p>
<p class="p5"><span class="s1">【出品詳細】</span></p>
<p class="p5"><span class="s1">出品審査 : 本展にふさわしい作品であるかを厳正に審査いたします。自由出品（褒章審査対象外）の場合も、適切な作品であることを確認いたしますが、出品物に対する最終責任は出品者ご本人様とさせていただきます。</span></p>
<p class="p5"><span class="s1">陳列開始 : 7年10月17日(金)午前10時30分を予定しております。</span></p>
<p class="p5"><span class="s1">褒章 : 経済産業省大臣官房商務・サービス審議官賞、近畿経済産業局長賞、知事賞、市長賞、京都府中小企業団体中央会会長賞、京都商工会議所会頭賞、京都新聞賞を予定しております。</span></p>
<p class="p5"><span class="s1">表彰式 : 令和8年1月の「京都表具協同組合新年会」にて執り行う予定です。</span></p>
<p class="p5"><span class="s1">出品点数 : お一人様何点でも出展可能です。長尺・幅広の表装および大型アートパネルも出品可能ですが、必ず事前にご相談ください。</span></p>
<p class="p5"><span class="s1">申込締切 : 7年10月7日(火)`</span><span class="s7">;</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// ファイル名と画像プレビューを表示する関数</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">function</span><span class="s1"> displayFileName</span><span class="s7">(</span><span class="s1">event</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> fileInput </span><span class="s7">=</span><span class="s1"> event</span><span class="s7">.</span><span class="s1">target</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> fileNameSpan </span><span class="s7">=</span><span class="s1"> document</span><span class="s7">.</span><span class="s1">getElementById</span><span class="s7">(</span><span class="s8">'fileName'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> uploadedImage </span><span class="s7">=</span><span class="s1"> document</span><span class="s7">.</span><span class="s1">getElementById</span><span class="s7">(</span><span class="s8">'uploadedImage'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> imagePreviewContainer </span><span class="s7">=</span><span class="s1"> document</span><span class="s7">.</span><span class="s1">getElementById</span><span class="s7">(</span><span class="s8">'imagePreviewContainer'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> file </span><span class="s7">=</span><span class="s1"> fileInput</span><span class="s7">.</span><span class="s1">files</span><span class="s7">[</span><span class="s13">0</span><span class="s7">];</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">if</span><span class="s1"> </span><span class="s7">(</span><span class="s1">file</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>fileNameSpan</span><span class="s7">.</span><span class="s1">textContent </span><span class="s7">=</span><span class="s1"> file</span><span class="s7">.</span><span class="s1">name</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>uploadedImage</span><span class="s7">.</span><span class="s1">src </span><span class="s7">=</span><span class="s1"> </span><span class="s12">URL</span><span class="s7">.</span><span class="s1">createObjectURL</span><span class="s7">(</span><span class="s1">file</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>imagePreviewContainer</span><span class="s7">.</span><span class="s1">classList</span><span class="s7">.</span><span class="s1">remove</span><span class="s7">(</span><span class="s8">'hidden'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">}</span><span class="s1"> </span><span class="s10">else</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>fileNameSpan</span><span class="s7">.</span><span class="s1">textContent </span><span class="s7">=</span><span class="s1"> </span><span class="s8">'ファイルを選択'</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>imagePreviewContainer</span><span class="s7">.</span><span class="s1">classList</span><span class="s7">.</span><span class="s1">add</span><span class="s7">(</span><span class="s8">'hidden'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// 画像とキーワードを分析し、キャプションを生成する関数</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">async</span><span class="s1"> </span><span class="s10">function</span><span class="s1"> analyzeImage</span><span class="s7">()</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> fileInput </span><span class="s7">=</span><span class="s1"> document</span><span class="s7">.</span><span class="s1">getElementById</span><span class="s7">(</span><span class="s8">'imageInput'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> keywordsInput </span><span class="s7">=</span><span class="s1"> document</span><span class="s7">.</span><span class="s1">getElementById</span><span class="s7">(</span><span class="s8">'keywordsInput'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> file </span><span class="s7">=</span><span class="s1"> fileInput</span><span class="s7">.</span><span class="s1">files</span><span class="s7">[</span><span class="s13">0</span><span class="s7">];</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> keywords </span><span class="s7">=</span><span class="s1"> keywordsInput</span><span class="s7">.</span><span class="s1">value</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> resultDiv </span><span class="s7">=</span><span class="s1"> document</span><span class="s7">.</span><span class="s1">getElementById</span><span class="s7">(</span><span class="s8">'imageAnalysisResult'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> generateButton </span><span class="s7">=</span><span class="s1"> document</span><span class="s7">.</span><span class="s1">querySelector</span><span class="s7">(</span><span class="s8">'button'</span><span class="s7">);</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">if</span><span class="s1"> </span><span class="s7">(!</span><span class="s1">file</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                </span>resultDiv</span><span class="s7">.</span><span class="s4">innerHTML </span><span class="s7">=</span><span class="s4"> </span><span class="s1">'&lt;p class="text-red-500"&gt;画像をアップロードしてください。&lt;/p&gt;'</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">return</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">}</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// ロード中のUIに切り替え</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">            </span>resultDiv</span><span class="s7">.</span><span class="s4">innerHTML </span><span class="s7">=</span><span class="s4"> </span><span class="s1">'&lt;div class="flex flex-col items-center space-y-2"&gt;&lt;div class="dot-pulse"&gt;&lt;/div&gt;&lt;p class="text-sm text-gray-500"&gt;AIが作品を分析中です。完了までしばらくお待ちください。&lt;/p&gt;&lt;/div&gt;'</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>generateButton</span><span class="s7">.</span><span class="s1">disabled </span><span class="s7">=</span><span class="s1"> </span><span class="s10">true</span><span class="s7">;</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> reader </span><span class="s7">=</span><span class="s1"> </span><span class="s10">new</span><span class="s1"> </span><span class="s12">FileReader</span><span class="s7">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>reader</span><span class="s7">.</span><span class="s1">onloadend </span><span class="s7">=</span><span class="s1"> </span><span class="s10">async</span><span class="s1"> </span><span class="s7">()</span><span class="s1"> </span><span class="s7">=&gt;</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>currentImageBase64 </span><span class="s7">=</span><span class="s1"> reader</span><span class="s7">.</span><span class="s1">result</span><span class="s7">.</span><span class="s1">split</span><span class="s7">(</span><span class="s8">','</span><span class="s7">)[</span><span class="s13">1</span><span class="s7">];</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>currentKeywords </span><span class="s7">=</span><span class="s1"> keywords</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>currentMimeType </span><span class="s7">=</span><span class="s1"> file</span><span class="s7">.</span><span class="s1">type</span><span class="s7">;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s14">// プロンプトを構築</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s10">const</span><span class="s4"> prompt </span><span class="s7">=</span><span class="s4"> </span><span class="s1">`以下のドキュメントを参考に、この画像に写っている第70回記念表美展に出展する私の作品について、作者である表具師本人の目線で、3つの異なるキャプション案を生成してください。</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p5"><span class="s1">ドキュメント:</span></p>
<p class="p8"><span class="s8">"</span><span class="s7">${</span><span class="s1">EXHIBITION_DOCUMENT</span><span class="s7">}</span><span class="s8">"</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p5"><span class="s1">私の作品について、一人の表具師として、長年培ってきた技術や素材へのこだわり、そして「伝統的なものから新しい価値を生み出す」というテーマへの挑戦が伝わるように、キャプションを作成してください。作品の画像から読み取れる特徴（色、形、質感、構図、雰囲気など）に具体的に触れつつ、表具師ならではの専門的な視点や、作品に込めた精神性を語ってください。</span></p>
<p class="p5"><span class="s1">1つ目の案は、作品の**技術や素材の面白さ**、**形や色の美しさ**に焦点を当て、少し文学的で深みのある表現を使って、私がこの作品に込めた思いを説明してください。</span></p>
<p class="p5"><span class="s1">2つ目の案は、作品が持つ**物語性**や**感動的な側面**、**見る人に語りかけるメッセージ**に焦点を当て、共感を呼ぶような表現で、私がこの作品を通して伝えたいことを説明してください。</span></p>
<p class="p5"><span class="s1">3つ目の案は、作品の**見た目のインパクト**と、そこから生まれる**新しい表現の可能性**に焦点を当て、展示の場で目を引くような力強い表現で、私の表現への挑戦を説明してください。</span></p>
<p class="p5"><span class="s1">各キャプションは独立した文章として完結させ、見出しや箇条書きは含めないでください。</span></p>
<p class="p5"><span class="s1">「温故創新」という言葉を直接使わないでください。</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p5"><span class="s7">${</span><span class="s4">keywords </span><span class="s7">?</span><span class="s4"> </span><span class="s1">`\n以下のキーワードをキャプションに反映させてください: </span><span class="s7">${</span><span class="s4">keywords</span><span class="s7">}</span><span class="s1">`</span><span class="s4"> </span><span class="s7">:</span><span class="s4"> </span><span class="s1">''</span><span class="s7">}</span><span class="s1">`</span><span class="s7">;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span></span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s10">const</span><span class="s4"> apiUrl </span><span class="s7">=</span><span class="s4"> </span><span class="s1">`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=</span><span class="s7">${</span><span class="s12">API_KEY</span><span class="s7">}</span><span class="s1">`</span><span class="s7">;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// APIに送信するペイロードを構築</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">const</span><span class="s1"> payload </span><span class="s7">=</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>contents</span><span class="s7">:</span><span class="s1"> </span><span class="s7">[{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span>parts</span><span class="s7">:</span><span class="s1"> </span><span class="s7">[</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s7">{</span><span class="s1"> text</span><span class="s7">:</span><span class="s1"> prompt </span><span class="s7">},</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s7">{</span><span class="s1"> inlineData</span><span class="s7">:</span><span class="s1"> </span><span class="s7">{</span><span class="s1"> mimeType</span><span class="s7">:</span><span class="s1"> currentMimeType</span><span class="s7">,</span><span class="s1"> data</span><span class="s7">:</span><span class="s1"> currentImageBase64 </span><span class="s7">}</span><span class="s1"> </span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">]</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">}],</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>generationConfig</span><span class="s7">:</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span>responseMimeType</span><span class="s7">:</span><span class="s1"> </span><span class="s8">"application/json"</span><span class="s7">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span>responseSchema</span><span class="s7">:</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                            </span>type</span><span class="s7">:</span><span class="s1"> </span><span class="s8">"ARRAY"</span><span class="s7">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                            </span>items</span><span class="s7">:</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                                </span>type</span><span class="s7">:</span><span class="s1"> </span><span class="s8">"OBJECT"</span><span class="s7">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                                </span>properties</span><span class="s7">:</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                                    </span></span><span class="s8">"caption"</span><span class="s7">:</span><span class="s1"> </span><span class="s7">{</span><span class="s1"> </span><span class="s8">"type"</span><span class="s7">:</span><span class="s1"> </span><span class="s8">"STRING"</span><span class="s1"> </span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                                </span></span><span class="s7">},</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                                </span></span><span class="s8">"propertyOrdering"</span><span class="s7">:</span><span class="s1"> </span><span class="s7">[</span><span class="s8">"caption"</span><span class="s7">]</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">};</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">try</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s10">const</span><span class="s1"> result </span><span class="s7">=</span><span class="s1"> </span><span class="s10">await</span><span class="s1"> fetchWithRetry</span><span class="s7">(</span><span class="s1">apiUrl</span><span class="s7">,</span><span class="s1"> payload</span><span class="s7">);</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s10">if</span><span class="s1"> </span><span class="s7">(</span><span class="s1">result</span><span class="s7">.</span><span class="s1">candidates </span><span class="s7">&amp;&amp;</span><span class="s1"> result</span><span class="s7">.</span><span class="s1">candidates</span><span class="s7">[</span><span class="s13">0</span><span class="s7">].</span><span class="s1">content</span><span class="s7">.</span><span class="s1">parts</span><span class="s7">[</span><span class="s13">0</span><span class="s7">].</span><span class="s1">text</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s10">const</span><span class="s1"> rawJsonText </span><span class="s7">=</span><span class="s1"> result</span><span class="s7">.</span><span class="s1">candidates</span><span class="s7">[</span><span class="s13">0</span><span class="s7">].</span><span class="s1">content</span><span class="s7">.</span><span class="s1">parts</span><span class="s7">[</span><span class="s13">0</span><span class="s7">].</span><span class="s1">text</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s10">let</span><span class="s1"> captions</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s10">try</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                            </span>captions </span><span class="s7">=</span><span class="s1"> </span><span class="s12">JSON</span><span class="s7">.</span><span class="s1">parse</span><span class="s7">(</span><span class="s1">rawJsonText</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">}</span><span class="s1"> </span><span class="s10">catch</span><span class="s1"> </span><span class="s7">(</span><span class="s1">directParseError</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s10">const</span><span class="s1"> jsonMatch </span><span class="s7">=</span><span class="s1"> rawJsonText</span><span class="s7">.</span><span class="s1">match</span><span class="s7">(</span><span class="s15">/\[\s*\{[\s\S]*\}\s*\]/</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s10">if</span><span class="s1"> </span><span class="s7">(</span><span class="s1">jsonMatch </span><span class="s7">&amp;&amp;</span><span class="s1"> jsonMatch</span><span class="s7">[</span><span class="s13">0</span><span class="s7">])</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                                </span></span><span class="s10">try</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                                    </span>captions </span><span class="s7">=</span><span class="s1"> </span><span class="s12">JSON</span><span class="s7">.</span><span class="s1">parse</span><span class="s7">(</span><span class="s1">jsonMatch</span><span class="s7">[</span><span class="s13">0</span><span class="s7">]);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                                </span></span><span class="s7">}</span><span class="s1"> </span><span class="s10">catch</span><span class="s1"> </span><span class="s7">(</span><span class="s1">regexParseError</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                                    </span></span><span class="s10">throw</span><span class="s1"> </span><span class="s10">new</span><span class="s1"> </span><span class="s12">Error</span><span class="s7">(</span><span class="s8">'抽出したJSONの解析に失敗しました: '</span><span class="s1"> </span><span class="s7">+</span><span class="s1"> regexParseError</span><span class="s7">.</span><span class="s1">message</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                                </span></span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s7">}</span><span class="s1"> </span><span class="s10">else</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                                </span></span><span class="s10">throw</span><span class="s1"> </span><span class="s10">new</span><span class="s1"> </span><span class="s12">Error</span><span class="s7">(</span><span class="s8">'API応答に有効なJSONブロックが見つかりませんでした。'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">}</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                        </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s10">if</span><span class="s1"> </span><span class="s7">(!</span><span class="s12">Array</span><span class="s7">.</span><span class="s1">isArray</span><span class="s7">(</span><span class="s1">captions</span><span class="s7">)</span><span class="s1"> </span><span class="s7">||</span><span class="s1"> captions</span><span class="s7">.</span><span class="s1">length </span><span class="s7">&lt;</span><span class="s1"> </span><span class="s13">3</span><span class="s1"> </span><span class="s7">||</span><span class="s1"> </span><span class="s7">!</span><span class="s1">captions</span><span class="s7">[</span><span class="s13">0</span><span class="s7">].</span><span class="s1">caption</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                            </span></span><span class="s10">throw</span><span class="s4"> </span><span class="s10">new</span><span class="s4"> </span><span class="s12">Error</span><span class="s7">(</span><span class="s1">'無効なJSON構造です。少なくとも3つのオブジェクトを含む配列を期待しました。'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">}</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s10">let</span><span class="s1"> resultHtml </span><span class="s7">=</span><span class="s1"> </span><span class="s8">`</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;div class="space-y-6"&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                                </span></span><span class="s7">${</span><span class="s4">captions</span><span class="s7">.</span><span class="s4">map</span><span class="s7">((</span><span class="s4">item</span><span class="s7">,</span><span class="s4"> index</span><span class="s7">)</span><span class="s4"> </span><span class="s7">=&gt;</span><span class="s4"> </span><span class="s1">`</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                                    </span>&lt;div class="p-4 rounded-md card"&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                                        </span>&lt;div class="flex items-center justify-between"&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                                            </span>&lt;h3 class="font-bold text-lg mb-2 text-[#4A4A4A]"&gt;キャプション案</span><span class="s7">${</span><span class="s4">index </span><span class="s7">+</span><span class="s4"> </span><span class="s13">1</span><span class="s7">}</span><span class="s1">&lt;/h3&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                                            </span>&lt;div class="flex space-x-2"&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                                                </span>&lt;button onclick="copyToClipboard(this)" class="text-sm px-3 py-1 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 transition-colors"&gt;コピー&lt;/button&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                                                </span>&lt;button onclick="startChat(</span><span class="s7">${</span><span class="s4">index</span><span class="s7">}</span><span class="s1">, \`</span><span class="s7">${</span><span class="s4">escapeHtml</span><span class="s7">(</span><span class="s4">item</span><span class="s7">.</span><span class="s4">caption</span><span class="s7">)}</span><span class="s1">\`)" class="text-sm px-3 py-1 bg-[#0E4D92] text-white rounded-md hover:bg-[#1263B7]"&gt;AIとチャットする&lt;/button&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                                            </span>&lt;/div&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                                        </span>&lt;/div&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                                        </span>&lt;p class="mt-2 caption-text" data-index="</span><span class="s7">${</span><span class="s4">index</span><span class="s7">}</span><span class="s1">"&gt;</span><span class="s7">${</span><span class="s4">item</span><span class="s7">.</span><span class="s4">caption</span><span class="s7">}</span><span class="s1">&lt;/p&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                                    </span>&lt;/div&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                                </span>`</span><span class="s7">).</span><span class="s4">join</span><span class="s7">(</span><span class="s1">''</span><span class="s7">)}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;/div&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>`</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span>resultDiv</span><span class="s7">.</span><span class="s1">innerHTML </span><span class="s7">=</span><span class="s1"> resultHtml</span><span class="s7">;</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">}</span><span class="s1"> </span><span class="s10">else</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s10">throw</span><span class="s1"> </span><span class="s10">new</span><span class="s1"> </span><span class="s12">Error</span><span class="s7">(</span><span class="s8">'APIから有効な応答がありませんでした。'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">}</span><span class="s1"> </span><span class="s10">catch</span><span class="s1"> </span><span class="s7">(</span><span class="s1">error</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>console</span><span class="s7">.</span><span class="s1">error</span><span class="s7">(</span><span class="s8">'Error analyzing image:'</span><span class="s7">,</span><span class="s1"> error</span><span class="s7">);</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                    </span>resultDiv</span><span class="s7">.</span><span class="s4">innerHTML </span><span class="s7">=</span><span class="s4"> </span><span class="s1">`&lt;p class="text-red-500"&gt;キャプションの生成中にエラーが発生しました。詳細: </span><span class="s7">${</span><span class="s4">error</span><span class="s7">.</span><span class="s4">message</span><span class="s7">}</span><span class="s1">&lt;/p&gt;`</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">}</span><span class="s1"> </span><span class="s10">finally</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>generateButton</span><span class="s7">.</span><span class="s1">disabled </span><span class="s7">=</span><span class="s1"> </span><span class="s10">false</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">};</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>reader</span><span class="s7">.</span><span class="s1">readAsDataURL</span><span class="s7">(</span><span class="s1">file</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// 特定のキャプションを編集するためのチャットUIを開始する関数</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">async</span><span class="s1"> </span><span class="s10">function</span><span class="s1"> startChat</span><span class="s7">(</span><span class="s1">captionIndex</span><span class="s7">,</span><span class="s1"> initialCaption</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> resultDiv </span><span class="s7">=</span><span class="s1"> document</span><span class="s7">.</span><span class="s1">getElementById</span><span class="s7">(</span><span class="s8">'imageAnalysisResult'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> chatHtml </span><span class="s7">=</span><span class="s1"> </span><span class="s8">`</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div id="chatInterface" class="space-y-4"&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;button onclick="resetApp()" class="text-sm py-1 px-3 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 transition-colors mb-4"&gt;← 戻る&lt;/button&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div id="chatHistory" class="h-48 sm:h-64 overflow-y-auto p-2 sm:p-4 bg-gray-50 rounded-md border border-gray-200"&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;div class="flex items-start mb-4"&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;span class="flex-shrink-0 inline-block p-2 rounded-full bg-[#0E4D92] text-white font-bold mr-2 sm:mr-3"&gt;AI&lt;/span&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;div class="p-2 sm:p-3 bg-white rounded-lg shadow-sm w-full"&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;p&gt;このキャプションを、どのように編集しましょうか？&lt;/p&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;p class="mt-2 text-sm text-gray-500 caption-text break-words"&gt;"</span><span class="s7">${</span><span class="s4">initialCaption</span><span class="s7">}</span><span class="s1">"&lt;/p&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;/div&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div class="flex"&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;input type="text" id="chatInput" placeholder="例：もっと短くしてください" class="flex-grow p-2 rounded-l-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[#0E4D92] transition-all"&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;button onclick="sendChatMessage()" class="py-2 px-6 bg-[#0E4D92] text-white rounded-r-md hover:bg-[#1263B7]"&gt;送信&lt;/button&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>`</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>resultDiv</span><span class="s7">.</span><span class="s1">innerHTML </span><span class="s7">=</span><span class="s1"> chatHtml</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>document</span><span class="s7">.</span><span class="s1">getElementById</span><span class="s7">(</span><span class="s8">'chatInput'</span><span class="s7">).</span><span class="s1">focus</span><span class="s7">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// チャットメッセージを送信し、キャプションを再生成する関数</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">async</span><span class="s1"> </span><span class="s10">function</span><span class="s1"> sendChatMessage</span><span class="s7">()</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> chatInput </span><span class="s7">=</span><span class="s1"> document</span><span class="s7">.</span><span class="s1">getElementById</span><span class="s7">(</span><span class="s8">'chatInput'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> userMessage </span><span class="s7">=</span><span class="s1"> chatInput</span><span class="s7">.</span><span class="s1">value</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> chatHistory </span><span class="s7">=</span><span class="s1"> document</span><span class="s7">.</span><span class="s1">getElementById</span><span class="s7">(</span><span class="s8">'chatHistory'</span><span class="s7">);</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">if</span><span class="s1"> </span><span class="s7">(!</span><span class="s1">userMessage</span><span class="s7">.</span><span class="s1">trim</span><span class="s7">())</span><span class="s1"> </span><span class="s10">return</span><span class="s7">;</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// ユーザーメッセージを追加</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> userMessageDiv </span><span class="s7">=</span><span class="s1"> document</span><span class="s7">.</span><span class="s1">createElement</span><span class="s7">(</span><span class="s8">'div'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>userMessageDiv</span><span class="s7">.</span><span class="s1">className </span><span class="s7">=</span><span class="s1"> </span><span class="s8">"flex items-start justify-end mb-4"</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>userMessageDiv</span><span class="s7">.</span><span class="s1">innerHTML </span><span class="s7">=</span><span class="s1"> </span><span class="s8">`</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="p-2 sm:p-3 bg-[#EBF5FF] rounded-lg shadow-sm max-w-[80%]"&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;p class="break-words"&gt;</span><span class="s7">${</span><span class="s4">escapeHtml</span><span class="s7">(</span><span class="s4">userMessage</span><span class="s7">)}</span><span class="s1">&lt;/p&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>&lt;span class="flex-shrink-0 inline-block p-2 rounded-full bg-gray-400 text-white font-bold ml-2 sm:ml-3"&gt;あなた&lt;/span&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>`</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>chatHistory</span><span class="s7">.</span><span class="s1">appendChild</span><span class="s7">(</span><span class="s1">userMessageDiv</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>chatHistory</span><span class="s7">.</span><span class="s1">scrollTop </span><span class="s7">=</span><span class="s1"> chatHistory</span><span class="s7">.</span><span class="s1">scrollHeight</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>chatInput</span><span class="s7">.</span><span class="s1">value </span><span class="s7">=</span><span class="s1"> </span><span class="s8">""</span><span class="s7">;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// ローディングインジケーターを追加</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> loadingDiv </span><span class="s7">=</span><span class="s1"> document</span><span class="s7">.</span><span class="s1">createElement</span><span class="s7">(</span><span class="s8">'div'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>loadingDiv</span><span class="s7">.</span><span class="s1">id </span><span class="s7">=</span><span class="s1"> </span><span class="s8">"loadingIndicator"</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>loadingDiv</span><span class="s7">.</span><span class="s1">className </span><span class="s7">=</span><span class="s1"> </span><span class="s8">"flex items-start mb-4"</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>loadingDiv</span><span class="s7">.</span><span class="s1">innerHTML </span><span class="s7">=</span><span class="s1"> </span><span class="s8">`</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>&lt;span class="flex-shrink-0 inline-block p-2 rounded-full bg-[#0E4D92] text-white font-bold mr-2 sm:mr-3"&gt;AI&lt;/span&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="p-2 sm:p-3 bg-white rounded-lg shadow-sm"&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div class="dot-pulse"&gt;&lt;/div&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>`</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>chatHistory</span><span class="s7">.</span><span class="s1">appendChild</span><span class="s7">(</span><span class="s1">loadingDiv</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>chatHistory</span><span class="s7">.</span><span class="s1">scrollTop </span><span class="s7">=</span><span class="s1"> chatHistory</span><span class="s7">.</span><span class="s1">scrollHeight</span><span class="s7">;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> currentCaptionElement </span><span class="s7">=</span><span class="s1"> document</span><span class="s7">.</span><span class="s1">getElementById</span><span class="s7">(</span><span class="s8">'chatHistory'</span><span class="s7">).</span><span class="s1">querySelector</span><span class="s7">(</span><span class="s8">'p.text-sm'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> currentCaption </span><span class="s7">=</span><span class="s1"> currentCaptionElement </span><span class="s7">?</span><span class="s1"> currentCaptionElement</span><span class="s7">.</span><span class="s1">textContent</span><span class="s7">.</span><span class="s1">trim</span><span class="s7">().</span><span class="s1">replace</span><span class="s7">(</span><span class="s15">/^"/</span><span class="s7">,</span><span class="s1"> </span><span class="s8">''</span><span class="s7">).</span><span class="s1">replace</span><span class="s7">(</span><span class="s15">/"$/</span><span class="s7">,</span><span class="s1"> </span><span class="s8">''</span><span class="s7">)</span><span class="s1"> </span><span class="s7">:</span><span class="s1"> </span><span class="s8">""</span><span class="s7">;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">try</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s14">// プロンプトを構築</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s10">const</span><span class="s4"> prompt </span><span class="s7">=</span><span class="s4"> </span><span class="s1">`以下のキャプションを、ユーザーの指示に沿って、作者である表具師の視点をより強く反映させて再生成してください。</span></p>
<p class="p9"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p4"><span class="s8">現在のキャプション: "</span><span class="s7">${</span><span class="s1">currentCaption</span><span class="s7">}</span><span class="s8">"</span></p>
<p class="p4"><span class="s8">ユーザーの指示: "</span><span class="s7">${</span><span class="s1">userMessage</span><span class="s7">}</span><span class="s8">"</span></p>
<p class="p4"><span class="s7">${</span><span class="s1">currentKeywords </span><span class="s7">?</span><span class="s1"> </span><span class="s8">`\n以下のキーワードも考慮してください: </span><span class="s7">${</span><span class="s1">currentKeywords</span><span class="s7">}</span><span class="s8">`</span><span class="s1"> </span><span class="s7">:</span><span class="s1"> </span><span class="s8">''</span><span class="s7">}</span><span class="s8">`</span><span class="s7">;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s10">const</span><span class="s4"> apiUrl </span><span class="s7">=</span><span class="s4"> </span><span class="s1">`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=</span><span class="s7">${</span><span class="s12">API_KEY</span><span class="s7">}</span><span class="s1">`</span><span class="s7">;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// APIに送信するペイロードを構築</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">const</span><span class="s1"> payload </span><span class="s7">=</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>contents</span><span class="s7">:</span><span class="s1"> </span><span class="s7">[{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span>parts</span><span class="s7">:</span><span class="s1"> </span><span class="s7">[</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s7">{</span><span class="s1"> text</span><span class="s7">:</span><span class="s1"> prompt </span><span class="s7">},</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s7">{</span><span class="s1"> inlineData</span><span class="s7">:</span><span class="s1"> </span><span class="s7">{</span><span class="s1"> mimeType</span><span class="s7">:</span><span class="s1"> currentMimeType</span><span class="s7">,</span><span class="s1"> data</span><span class="s7">:</span><span class="s1"> currentImageBase64 </span><span class="s7">}</span><span class="s1"> </span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">]</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">}],</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>generationConfig</span><span class="s7">:</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span>responseMimeType</span><span class="s7">:</span><span class="s1"> </span><span class="s8">"application/json"</span><span class="s7">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span>responseSchema</span><span class="s7">:</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                            </span>type</span><span class="s7">:</span><span class="s1"> </span><span class="s8">"OBJECT"</span><span class="s7">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                            </span>properties</span><span class="s7">:</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                                </span></span><span class="s8">"caption"</span><span class="s7">:</span><span class="s1"> </span><span class="s7">{</span><span class="s1"> </span><span class="s8">"type"</span><span class="s7">:</span><span class="s1"> </span><span class="s8">"STRING"</span><span class="s1"> </span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s7">},</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s8">"propertyOrdering"</span><span class="s7">:</span><span class="s1"> </span><span class="s7">[</span><span class="s8">"caption"</span><span class="s7">]</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">};</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">const</span><span class="s1"> result </span><span class="s7">=</span><span class="s1"> </span><span class="s10">await</span><span class="s1"> fetchWithRetry</span><span class="s7">(</span><span class="s1">apiUrl</span><span class="s7">,</span><span class="s1"> payload</span><span class="s7">);</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>document</span><span class="s7">.</span><span class="s1">getElementById</span><span class="s7">(</span><span class="s8">'loadingIndicator'</span><span class="s7">).</span><span class="s1">remove</span><span class="s7">();</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">if</span><span class="s1"> </span><span class="s7">(</span><span class="s1">result</span><span class="s7">.</span><span class="s1">candidates </span><span class="s7">&amp;&amp;</span><span class="s1"> result</span><span class="s7">.</span><span class="s1">candidates</span><span class="s7">[</span><span class="s13">0</span><span class="s7">].</span><span class="s1">content</span><span class="s7">.</span><span class="s1">parts</span><span class="s7">[</span><span class="s13">0</span><span class="s7">].</span><span class="s1">text</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s10">const</span><span class="s1"> rawJsonText </span><span class="s7">=</span><span class="s1"> result</span><span class="s7">.</span><span class="s1">candidates</span><span class="s7">[</span><span class="s13">0</span><span class="s7">].</span><span class="s1">content</span><span class="s7">.</span><span class="s1">parts</span><span class="s7">[</span><span class="s13">0</span><span class="s7">].</span><span class="s1">text</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s10">let</span><span class="s1"> newCaption</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s10">try</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s10">const</span><span class="s1"> parsed </span><span class="s7">=</span><span class="s1"> </span><span class="s12">JSON</span><span class="s7">.</span><span class="s1">parse</span><span class="s7">(</span><span class="s1">rawJsonText</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span>newCaption </span><span class="s7">=</span><span class="s1"> parsed</span><span class="s7">.</span><span class="s1">caption</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">}</span><span class="s1"> </span><span class="s10">catch</span><span class="s1"> </span><span class="s7">(</span><span class="s1">e</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s10">const</span><span class="s1"> captionMatch </span><span class="s7">=</span><span class="s1"> rawJsonText</span><span class="s7">.</span><span class="s1">match</span><span class="s7">(</span><span class="s15">/"caption"\s*:\s*"(.*?)"/</span><span class="s10">s</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span>newCaption </span><span class="s7">=</span><span class="s1"> captionMatch </span><span class="s7">?</span><span class="s1"> captionMatch</span><span class="s7">[</span><span class="s13">1</span><span class="s7">]</span><span class="s1"> </span><span class="s7">:</span><span class="s1"> rawJsonText</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">}</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s10">const</span><span class="s1"> aiMessageDiv </span><span class="s7">=</span><span class="s1"> document</span><span class="s7">.</span><span class="s1">createElement</span><span class="s7">(</span><span class="s8">'div'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>aiMessageDiv</span><span class="s7">.</span><span class="s1">className </span><span class="s7">=</span><span class="s1"> </span><span class="s8">"flex items-start mb-4"</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>aiMessageDiv</span><span class="s7">.</span><span class="s1">innerHTML </span><span class="s7">=</span><span class="s1"> </span><span class="s8">`</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;span class="flex-shrink-0 inline-block p-2 rounded-full bg-[#0E4D92] text-white font-bold mr-2 sm:mr-3"&gt;AI&lt;/span&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;div class="p-2 sm:p-3 bg-white rounded-lg shadow-sm w-full"&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;p class="break-words"&gt;</span><span class="s7">${</span><span class="s4">newCaption</span><span class="s7">}</span><span class="s1">&lt;/p&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;button onclick="copyToClipboard(this)" class="mt-2 text-sm px-3 py-1 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 transition-colors"&gt;コピー&lt;/button&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>`</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>chatHistory</span><span class="s7">.</span><span class="s1">appendChild</span><span class="s7">(</span><span class="s1">aiMessageDiv</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>chatHistory</span><span class="s7">.</span><span class="s1">scrollTop </span><span class="s7">=</span><span class="s1"> chatHistory</span><span class="s7">.</span><span class="s1">scrollHeight</span><span class="s7">;</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s1">// Update the underlying caption text for future edits</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s10">if</span><span class="s1"> </span><span class="s7">(</span><span class="s1">currentCaptionElement</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span>currentCaptionElement</span><span class="s7">.</span><span class="s1">textContent </span><span class="s7">=</span><span class="s1"> </span><span class="s8">`"</span><span class="s7">${</span><span class="s1">newCaption</span><span class="s7">}</span><span class="s8">"`</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">}</span><span class="s1"> </span><span class="s10">else</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s10">const</span><span class="s1"> errorMessageDiv </span><span class="s7">=</span><span class="s1"> document</span><span class="s7">.</span><span class="s1">createElement</span><span class="s7">(</span><span class="s8">'div'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>errorMessageDiv</span><span class="s7">.</span><span class="s1">className </span><span class="s7">=</span><span class="s1"> </span><span class="s8">"flex items-start mb-4"</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>errorMessageDiv</span><span class="s7">.</span><span class="s1">innerHTML </span><span class="s7">=</span><span class="s1"> </span><span class="s8">`</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;span class="flex-shrink-0 inline-block p-2 rounded-full bg-[#0E4D92] text-white font-bold mr-2 sm:mr-3"&gt;AI&lt;/span&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;div class="p-2 sm:p-3 bg-white rounded-lg shadow-sm w-full"&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;p class="text-red-500"&gt;キャプションの再生成中にエラーが発生しました。&lt;/p&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>`</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>chatHistory</span><span class="s7">.</span><span class="s1">appendChild</span><span class="s7">(</span><span class="s1">errorMessageDiv</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">}</span><span class="s1"> </span><span class="s10">catch</span><span class="s1"> </span><span class="s7">(</span><span class="s1">error</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>console</span><span class="s7">.</span><span class="s1">error</span><span class="s7">(</span><span class="s8">'Error in chat:'</span><span class="s7">,</span><span class="s1"> error</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>document</span><span class="s7">.</span><span class="s1">getElementById</span><span class="s7">(</span><span class="s8">'loadingIndicator'</span><span class="s7">).</span><span class="s1">remove</span><span class="s7">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">const</span><span class="s1"> errorMessageDiv </span><span class="s7">=</span><span class="s1"> document</span><span class="s7">.</span><span class="s1">createElement</span><span class="s7">(</span><span class="s8">'div'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>errorMessageDiv</span><span class="s7">.</span><span class="s1">className </span><span class="s7">=</span><span class="s1"> </span><span class="s8">"flex items-start mb-4"</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>errorMessageDiv</span><span class="s7">.</span><span class="s1">innerHTML </span><span class="s7">=</span><span class="s1"> </span><span class="s8">`</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;span class="flex-shrink-0 inline-block p-2 rounded-full bg-[#0E4D92] text-white font-bold mr-2 sm:mr-3"&gt;AI&lt;/span&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div class="p-2 sm:p-3 bg-white rounded-lg shadow-sm w-full"&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;p class="text-red-500"&gt;ネットワークエラーが発生しました。&lt;/p&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>`</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>chatHistory</span><span class="s7">.</span><span class="s1">appendChild</span><span class="s7">(</span><span class="s1">errorMessageDiv</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// アプリケーションの状態をリセットする関数</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">function</span><span class="s1"> resetApp</span><span class="s7">()</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> resultDiv </span><span class="s7">=</span><span class="s1"> document</span><span class="s7">.</span><span class="s1">getElementById</span><span class="s7">(</span><span class="s8">'imageAnalysisResult'</span><span class="s7">);</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">            </span>resultDiv</span><span class="s7">.</span><span class="s4">innerHTML </span><span class="s7">=</span><span class="s4"> </span><span class="s1">'&lt;p class="text-gray-400"&gt;ここにAIによるキャプションが表示されます。&lt;/p&gt;'</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>document</span><span class="s7">.</span><span class="s1">getElementById</span><span class="s7">(</span><span class="s8">'imageInput'</span><span class="s7">).</span><span class="s1">value </span><span class="s7">=</span><span class="s1"> </span><span class="s8">''</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>document</span><span class="s7">.</span><span class="s1">getElementById</span><span class="s7">(</span><span class="s8">'keywordsInput'</span><span class="s7">).</span><span class="s1">value </span><span class="s7">=</span><span class="s1"> </span><span class="s8">''</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>document</span><span class="s7">.</span><span class="s1">getElementById</span><span class="s7">(</span><span class="s8">'fileName'</span><span class="s7">).</span><span class="s1">textContent </span><span class="s7">=</span><span class="s1"> </span><span class="s8">'ファイルを選択'</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>document</span><span class="s7">.</span><span class="s1">getElementById</span><span class="s7">(</span><span class="s8">'imagePreviewContainer'</span><span class="s7">).</span><span class="s1">classList</span><span class="s7">.</span><span class="s1">add</span><span class="s7">(</span><span class="s8">'hidden'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>currentImageBase64 </span><span class="s7">=</span><span class="s1"> </span><span class="s10">null</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>currentKeywords </span><span class="s7">=</span><span class="s1"> </span><span class="s8">""</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>currentMimeType </span><span class="s7">=</span><span class="s1"> </span><span class="s10">null</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// API呼び出しにリトライ機能を実装したヘルパー関数</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">async</span><span class="s1"> </span><span class="s10">function</span><span class="s1"> fetchWithRetry</span><span class="s7">(</span><span class="s1">url</span><span class="s7">,</span><span class="s1"> payload</span><span class="s7">,</span><span class="s1"> retries </span><span class="s7">=</span><span class="s1"> </span><span class="s13">3</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">for</span><span class="s1"> </span><span class="s7">(</span><span class="s10">let</span><span class="s1"> i </span><span class="s7">=</span><span class="s1"> </span><span class="s13">0</span><span class="s7">;</span><span class="s1"> i </span><span class="s7">&lt;=</span><span class="s1"> retries</span><span class="s7">;</span><span class="s1"> i</span><span class="s7">++)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">try</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s10">const</span><span class="s1"> response </span><span class="s7">=</span><span class="s1"> </span><span class="s10">await</span><span class="s1"> fetch</span><span class="s7">(</span><span class="s1">url</span><span class="s7">,</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span>method</span><span class="s7">:</span><span class="s1"> </span><span class="s8">'POST'</span><span class="s7">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span>headers</span><span class="s7">:</span><span class="s1"> </span><span class="s7">{</span><span class="s1"> </span><span class="s8">'Content-Type'</span><span class="s7">:</span><span class="s1"> </span><span class="s8">'application/json'</span><span class="s1"> </span><span class="s7">},</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span>body</span><span class="s7">:</span><span class="s1"> </span><span class="s12">JSON</span><span class="s7">.</span><span class="s1">stringify</span><span class="s7">(</span><span class="s1">payload</span><span class="s7">)</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">});</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s10">if</span><span class="s1"> </span><span class="s7">(!</span><span class="s1">response</span><span class="s7">.</span><span class="s1">ok</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s10">throw</span><span class="s1"> </span><span class="s10">new</span><span class="s1"> </span><span class="s12">Error</span><span class="s7">(</span><span class="s8">`API returned non-OK status: </span><span class="s7">${</span><span class="s1">response</span><span class="s7">.</span><span class="s1">status</span><span class="s7">}</span><span class="s8"> </span><span class="s7">${</span><span class="s1">response</span><span class="s7">.</span><span class="s1">statusText</span><span class="s7">}</span><span class="s8">`</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">}</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s10">const</span><span class="s1"> json </span><span class="s7">=</span><span class="s1"> </span><span class="s10">await</span><span class="s1"> response</span><span class="s7">.</span><span class="s1">json</span><span class="s7">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s10">return</span><span class="s1"> json</span><span class="s7">;</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">}</span><span class="s1"> </span><span class="s10">catch</span><span class="s1"> </span><span class="s7">(</span><span class="s1">error</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>console</span><span class="s7">.</span><span class="s1">error</span><span class="s7">(</span><span class="s8">`Attempt </span><span class="s7">${</span><span class="s1">i </span><span class="s7">+</span><span class="s1"> </span><span class="s13">1</span><span class="s7">}</span><span class="s8"> failed:`</span><span class="s7">,</span><span class="s1"> error</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s10">if</span><span class="s1"> </span><span class="s7">(</span><span class="s1">i </span><span class="s7">&lt;</span><span class="s1"> retries </span><span class="s7">&amp;&amp;</span><span class="s1"> </span><span class="s7">(</span><span class="s1">error </span><span class="s10">instanceof</span><span class="s1"> </span><span class="s12">SyntaxError</span><span class="s1"> </span><span class="s7">||</span><span class="s1"> error </span><span class="s10">instanceof</span><span class="s1"> </span><span class="s12">TypeError</span><span class="s7">))</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s10">await</span><span class="s1"> </span><span class="s10">new</span><span class="s1"> </span><span class="s12">Promise</span><span class="s7">(</span><span class="s1">res </span><span class="s7">=&gt;</span><span class="s1"> setTimeout</span><span class="s7">(</span><span class="s1">res</span><span class="s7">,</span><span class="s1"> </span><span class="s13">1000</span><span class="s1"> </span><span class="s7">*</span><span class="s1"> </span><span class="s7">(</span><span class="s1">i </span><span class="s7">+</span><span class="s1"> </span><span class="s13">1</span><span class="s7">)));</span><span class="s1"> </span><span class="s14">// Exponential backoff</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s10">continue</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s10">throw</span><span class="s1"> error</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// テキストをクリップボードにコピーする関数</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">function</span><span class="s1"> copyToClipboard</span><span class="s7">(</span><span class="s1">buttonElement</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> container </span><span class="s7">=</span><span class="s1"> buttonElement</span><span class="s7">.</span><span class="s1">closest</span><span class="s7">(</span><span class="s8">'div'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> textElement </span><span class="s7">=</span><span class="s1"> container</span><span class="s7">.</span><span class="s1">querySelector</span><span class="s7">(</span><span class="s8">'p:not([class*="text-gray-500"])'</span><span class="s7">);</span><span class="s1"> </span><span class="s14">// The main text</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">if</span><span class="s1"> </span><span class="s7">(</span><span class="s1">textElement</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">const</span><span class="s1"> textToCopy </span><span class="s7">=</span><span class="s1"> textElement</span><span class="s7">.</span><span class="s1">textContent</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">const</span><span class="s1"> tempTextArea </span><span class="s7">=</span><span class="s1"> document</span><span class="s7">.</span><span class="s1">createElement</span><span class="s7">(</span><span class="s8">'textarea'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>tempTextArea</span><span class="s7">.</span><span class="s1">value </span><span class="s7">=</span><span class="s1"> textToCopy</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>document</span><span class="s7">.</span><span class="s1">body</span><span class="s7">.</span><span class="s1">appendChild</span><span class="s7">(</span><span class="s1">tempTextArea</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>tempTextArea</span><span class="s7">.</span><span class="s1">select</span><span class="s7">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">try</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s10">const</span><span class="s1"> successful </span><span class="s7">=</span><span class="s1"> document</span><span class="s7">.</span><span class="s1">execCommand</span><span class="s7">(</span><span class="s8">'copy'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s10">const</span><span class="s1"> confirmationSpan </span><span class="s7">=</span><span class="s1"> document</span><span class="s7">.</span><span class="s1">createElement</span><span class="s7">(</span><span class="s8">'span'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>confirmationSpan</span><span class="s7">.</span><span class="s1">className </span><span class="s7">=</span><span class="s1"> </span><span class="s8">'text-xs text-green-600 ml-2'</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>confirmationSpan</span><span class="s7">.</span><span class="s1">textContent </span><span class="s7">=</span><span class="s1"> successful </span><span class="s7">?</span><span class="s1"> </span><span class="s8">'コピーしました！'</span><span class="s1"> </span><span class="s7">:</span><span class="s1"> </span><span class="s8">'コピーに失敗しました'</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>buttonElement</span><span class="s7">.</span><span class="s1">after</span><span class="s7">(</span><span class="s1">confirmationSpan</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>setTimeout</span><span class="s7">(()</span><span class="s1"> </span><span class="s7">=&gt;</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span>confirmationSpan</span><span class="s7">.</span><span class="s1">remove</span><span class="s7">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">},</span><span class="s1"> </span><span class="s13">2000</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">}</span><span class="s1"> </span><span class="s10">catch</span><span class="s1"> </span><span class="s7">(</span><span class="s1">err</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                    </span>console</span><span class="s7">.</span><span class="s4">error</span><span class="s7">(</span><span class="s1">'Failed to copy text using execCommand: '</span><span class="s7">,</span><span class="s4"> err</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">}</span><span class="s1"> </span><span class="s10">finally</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>document</span><span class="s7">.</span><span class="s1">body</span><span class="s7">.</span><span class="s1">removeChild</span><span class="s7">(</span><span class="s1">tempTextArea</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">}</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">}</span><span class="s1"> </span><span class="s10">else</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                 </span></span><span class="s10">const</span><span class="s1"> cardContainer </span><span class="s7">=</span><span class="s1"> buttonElement</span><span class="s7">.</span><span class="s1">closest</span><span class="s7">(</span><span class="s8">'.card'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                 </span></span><span class="s10">const</span><span class="s1"> cardTextElement </span><span class="s7">=</span><span class="s1"> cardContainer</span><span class="s7">.</span><span class="s1">querySelector</span><span class="s7">(</span><span class="s8">'.caption-text'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                 </span></span><span class="s10">if</span><span class="s1"> </span><span class="s7">(</span><span class="s1">cardTextElement</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s10">const</span><span class="s1"> textToCopy </span><span class="s7">=</span><span class="s1"> cardTextElement</span><span class="s7">.</span><span class="s1">textContent</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                     </span></span><span class="s10">const</span><span class="s1"> tempTextArea </span><span class="s7">=</span><span class="s1"> document</span><span class="s7">.</span><span class="s1">createElement</span><span class="s7">(</span><span class="s8">'textarea'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>tempTextArea</span><span class="s7">.</span><span class="s1">value </span><span class="s7">=</span><span class="s1"> textToCopy</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>document</span><span class="s7">.</span><span class="s1">body</span><span class="s7">.</span><span class="s1">appendChild</span><span class="s7">(</span><span class="s1">tempTextArea</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>tempTextArea</span><span class="s7">.</span><span class="s1">select</span><span class="s7">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s10">try</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s10">const</span><span class="s1"> successful </span><span class="s7">=</span><span class="s1"> document</span><span class="s7">.</span><span class="s1">execCommand</span><span class="s7">(</span><span class="s8">'copy'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s10">const</span><span class="s1"> confirmationSpan </span><span class="s7">=</span><span class="s1"> document</span><span class="s7">.</span><span class="s1">createElement</span><span class="s7">(</span><span class="s8">'span'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span>confirmationSpan</span><span class="s7">.</span><span class="s1">className </span><span class="s7">=</span><span class="s1"> </span><span class="s8">'text-xs text-green-600 ml-2'</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span>confirmationSpan</span><span class="s7">.</span><span class="s1">textContent </span><span class="s7">=</span><span class="s1"> successful </span><span class="s7">?</span><span class="s1"> </span><span class="s8">'コピーしました！'</span><span class="s1"> </span><span class="s7">:</span><span class="s1"> </span><span class="s8">'コピーに失敗しました'</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span>buttonElement</span><span class="s7">.</span><span class="s1">after</span><span class="s7">(</span><span class="s1">confirmationSpan</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span>setTimeout</span><span class="s7">(()</span><span class="s1"> </span><span class="s7">=&gt;</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                            </span>confirmationSpan</span><span class="s7">.</span><span class="s1">remove</span><span class="s7">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">},</span><span class="s1"> </span><span class="s13">2000</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">}</span><span class="s1"> </span><span class="s10">catch</span><span class="s1"> </span><span class="s7">(</span><span class="s1">err</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                        </span>console</span><span class="s7">.</span><span class="s4">error</span><span class="s7">(</span><span class="s1">'Failed to copy text using execCommand: '</span><span class="s7">,</span><span class="s4"> err</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">}</span><span class="s1"> </span><span class="s10">finally</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span>document</span><span class="s7">.</span><span class="s1">body</span><span class="s7">.</span><span class="s1">removeChild</span><span class="s7">(</span><span class="s1">tempTextArea</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                 </span></span><span class="s7">}</span><span class="s1"> </span><span class="s10">else</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                    </span>console</span><span class="s7">.</span><span class="s4">error</span><span class="s7">(</span><span class="s1">'Could not find text element to copy.'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                 </span></span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// HTML特殊文字をエスケープする関数</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">function</span><span class="s1"> escapeHtml</span><span class="s7">(</span><span class="s1">unsafe</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">return</span><span class="s1"> unsafe</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">.</span><span class="s1">replace</span><span class="s7">(</span><span class="s15">/&amp;/</span><span class="s10">g</span><span class="s7">,</span><span class="s1"> </span><span class="s8">"&amp;amp;"</span><span class="s7">)</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">.</span><span class="s1">replace</span><span class="s7">(</span><span class="s15">/&lt;/</span><span class="s10">g</span><span class="s7">,</span><span class="s1"> </span><span class="s8">"&amp;lt;"</span><span class="s7">)</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">.</span><span class="s1">replace</span><span class="s7">(</span><span class="s15">/&gt;/</span><span class="s10">g</span><span class="s7">,</span><span class="s1"> </span><span class="s8">"&amp;gt;"</span><span class="s7">)</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">.</span><span class="s1">replace</span><span class="s7">(</span><span class="s15">/"/</span><span class="s10">g</span><span class="s7">,</span><span class="s1"> </span><span class="s8">"&amp;quot;"</span><span class="s7">)</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">.</span><span class="s1">replace</span><span class="s7">(</span><span class="s15">/'/</span><span class="s10">g</span><span class="s7">,</span><span class="s1"> </span><span class="s8">"&amp;#039;"</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;/</span><span class="s1">script</span><span class="s3">&gt;</span></p>
<p class="p1"><span class="s3">&lt;/</span><span class="s1">body</span><span class="s3">&gt;</span></p>
<p class="p1"><span class="s3">&lt;/</span><span class="s1">html</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p6"><span class="s11"></span><br></p>
</body>
</html>
